# Fusion360BatchParametricExport

## 项目简介

用于 Fusion360 参数化批量一键导出的专业插件，支持多种导出格式和 Excel 配置管理。

> **注意：本项目为AI自动生成，几乎未经过人工编码。请在实际使用前充分测试和评估其功能与安全性。**

---

## 安装与环境要求

### 安装方法
1. **通过 Fusion360 插件管理器安装**
   - 打开 Fusion360
   - 菜单栏点击“工具” → “插件和脚本”
   - 在弹出的对话框中点击“脚本”选项卡
   - 点击“添加”按钮，选择本插件文件夹
   - 插件会出现在脚本列表中
   - 你需要确保"运行"开关是打开的
   - 如果长期使用, 建议勾选启动时运行
2. **手动复制到插件目录**
   - Windows: `%appdata%\Autodesk\Autodesk Fusion 360\API\Scripts`
   - Mac: `~/Library/Application Support/Autodesk/Autodesk Fusion 360/API/Scripts`
   - 将插件文件夹复制到上述目录
   - 重启 Fusion360

### 系统要求
- Fusion 360 2023 或更高版本
- Windows 10/11
- 支持的设计文件格式：.f3d

---

## 文件结构

```
BatchParametricExport/
├── BatchParametricExport.py        # 主插件文件
├── BatchParametricExport.manifest  # 插件清单
├── ExportUtils.py                 # 导出工具模块
├── ConfigUtils.py                 # 配置工具模块
├── CacheUtils.py                  # 缓存工具
├── CommandCreatedEventHandler.py  # UI 事件
├── CommandInputChangedHandler.py  # 输入事件
├── CommandExecuteHandler.py       # 执行事件
├── openpyxl/                      # Excel 读写主库 (v3.1.5)
├── et_xmlfile/                    # XML 写入依赖库 (v1.1.0)
├── config.json                    # 配置文件
├── README.md                      # 项目说明
└── ...其他文件
```

---

## 快速开始

1. 在 Fusion360 中打开包含多个零件的设计
2. 将需要批量修改的参数设置为“收藏”（标星）
3. 启动插件，点击“📤 导出模板”按钮，生成包含所有标星参数的 Excel 模板
    > 插件入口：在 Fusion360 顶部菜单栏依次点击 “实用程序” => “附加模块” => “批量参数化导出” 即可打开插件UI。
4. 在 Excel 文件中编辑配置（导出格式、名称、参数值等）
5. 保存 Excel 文件，在插件中点击“导出”按钮，自动读取 Excel 配置并批量导出

---

## 功能总览

- **参数化批量导出**：读取标星参数，支持多组参数配置
- **每个零件单独导出**：自动识别子组件，每个零件导出为独立文件
- **智能目录结构**：按文档名和配置名创建层级目录，文件名包含零件名和配置名
- **版本号处理**：可选择忽略文档名中的版本号，使用简洁的目录名
- **多格式支持**：支持 STEP、IGES、STL、OBJ、3MF 等主流格式
- **可见性控制**：确保每个零件单独导出
- **Excel 配置管理**：支持 Excel 文件配置管理，批量配置更直观
- **完善的错误处理与日志**

---

## Excel 配置管理

### 1. 生成 Excel 模板
- 启动插件后，点击“📤 导出模板”按钮，选择保存位置，生成包含所有标星参数的 Excel 模板

### 2. 编辑配置
- 在 Excel 文件中编辑配置（表头会自动包含参数注释，支持换行显示）：
  | 导出格式 | 自定义名称 | 长度<br>(零件长度) | 宽度<br>(零件宽度) | 高度<br>(零件高度) |
  |---------|-----------|-------------------|-------------------|-------------------|
  | step    | 小零件    | 10mm              | 5mm               | 3mm                |
  | stl     | 大零件    | 20mm              | 10mm              | 6mm                |
  | iges    | 测试零件  | 15mm              | 8mm               | 4mm                |

### 3. 执行导出
- 保存 Excel 文件，在插件中点击“导出”按钮，插件自动读取 Excel 配置并执行批量导出

### 4. 配置格式说明
- **导出格式**：step, iges, stl, obj, 3mf
- **自定义名称**：必填，用于创建子目录和文件名
- **参数值**：为每组配置设置不同的参数值，支持单位、表达式、参数引用
- **参数注释**：Excel表头会自动显示参数的注释信息，格式为"参数名\n(注释内容)"，支持换行显示，方便用户理解参数含义

### 5. 导出结果
```
导出目录/
└── 文档名/
    ├── 小零件/
    │   ├── 小零件.step
    │   ├── 小零件.f3d
    │   └── 其他零件.step
    ├── 大零件/
    │   ├── 大零件.stl
    │   ├── 大零件.f3d
    │   └── 其他零件.stl
    └── 测试零件/
        ├── 测试零件.iges
        ├── 测试零件.f3d
        └── 其他零件.iges
```

### 6. 常见问题与故障排查
- **Q: 插件提示“未找到任何标星参数”？**
  - 请确保在 Fusion 360 参数面板中将需要批量修改的参数标星（收藏）
- **Q: Excel 文件读取失败？**
  - 检查文件路径是否正确、文件是否存在、格式是否为 .xlsx
- **Q: 配置验证失败？**
  - 检查自定义名称是否为空，参数值是否为有效表达式
- **Q: Excel表头参数不匹配？**
  - 如果Excel文件中的参数列与当前设计不匹配，请重新导出Excel模板
  - 系统会自动检测并提示缺失的参数列
- **Q: 导出失败？**
  - 检查导出路径是否存在且有写入权限，参数值是否有效
- **Q: 插件无法加载？**
  - 检查文件是否完整复制到正确的插件目录，manifest 文件是否同名
- **Q: 找不到标星参数？**
  - 在“修改” → “更改参数”中，确认需要的参数已点击星形图标标记为收藏
- **Q: 参数应用失败？**
  - 检查参数值格式是否正确，确认参数表达式有效
- **Q: 参数化文本没有更新？**
  - 确保已安装ParametricText插件，插件会自动触发文本更新
  - 如果文本仍未更新，请手动刷新设计或重新应用参数
- **Q: 导出目录名包含版本号？**
  - 勾选"忽略文档版本号"选项，系统会自动去除文档名中的版本号
  - 支持的格式：v13、_v13、-v13、[文档名 v13]等
- **Q: 文件覆盖？**
  - 如果目标文件已存在，会被覆盖
- **Q: 路径权限？**
  - 确保导出路径有写入权限

---

## 功能亮点与技术说明

- 智能组件识别：自动检测设计中的所有零件组件
- 文档级目录管理：按文档名创建独立目录，避免不同文档的导出文件混淆
- 版本号处理：可选择忽略文档名中的版本号，使用简洁的目录名，设置会被自动记忆
- 可见性控制导出：通过控制组件可见性实现单个零件导出
- 参数自动恢复：导出完成后自动恢复原始参数值
- 错误处理机制：完善的错误处理和进度提示
- 插件协作：自动触发ParametricText插件更新，确保参数化文本同步
- 文件名清理：自动处理特殊字符，确保文件名兼容性
- Excel 集成：集成 openpyxl 库，支持 Excel 文件读写
- 配置验证：自动验证 Excel 配置格式和必要字段
- 智能注释显示：Excel表头自动包含参数注释，提升用户体验
- 设置记忆功能：自动记忆导出路径、Excel文件路径、忽略版本号等用户设置
- ParametricText集成：自动触发ParametricText插件更新，确保参数化文本正确显示

---

## 贡献与许可证

欢迎提交 Issue 和 Pull Request 来改进这个插件！

本项目采用 MIT 许可证 - 详情见 [LICENSE](LICENSE)。